# 軍儀 (Gungi) - Flutter実装

HUNTER×HUNTERに登場する架空のボードゲーム「軍儀」をFlutterで完全実装したアプリケーションです。

## 概要

軍儀は、冨樫義博の漫画「HUNTER×HUNTER」に登場する戦略ボードゲームです。将棋や囲碁に似た要素を持ちながら、駒を重ねる「ツケ」という独自のシステムが特徴です。

本アプリは、UMS（Universal Makyo System）ルールに準拠し、2人対戦およびCPU対戦をサポートしています。

## 特徴

### ゲームモード
- **2人対戦**: 同じ端末で対面対戦
- **CPU対戦**: 3段階の難易度（初級・中級・上級）

### ルールレベル
| レベル | 配置 | 特殊駒 | 最大段数 |
|--------|------|--------|----------|
| 入門編 | 固定 | なし | 2段 |
| 初級編 | 固定 | なし | 2段 |
| 中級編 | 自由 | なし | 2段 |
| 上級編 | 自由 | あり | 3段 |

### UI/UX
- 原作をイメージした和風デザイン（木目調盤面、金と漆黒の配色）
- 駒選択時のグローアニメーション
- 合法手のパルスアニメーション表示
- 棋譜の記録・表示機能
- スタック（重なった駒）の詳細表示

## ゲームルール

### 基本ルール
- 9×9マスの盤面で対戦
- 各プレイヤーは25枚の駒を使用
- 相手の「帥（すい）」を捕獲したら勝利

### 駒の種類（14種類）

| 駒名 | 漢字 | 枚数 | 説明 |
|------|------|------|------|
| 帥 | 帥 | 1 | 王将相当。これを取られたら負け |
| 大将 | 大 | 1 | 全方向に移動可能 |
| 中将 | 中 | 1 | 前方と斜めに移動 |
| 小将 | 小 | 2 | 前方と左右に移動 |
| 侍 | 侍 | 2 | 斜め方向に移動 |
| 忍 | 忍 | 2 | 桂馬跳びと斜め移動 |
| 兵 | 兵 | 4 | 前方1マスのみ |
| 槍 | 槍 | 3 | 前方に直進 |
| 馬 | 馬 | 2 | 前方と斜め後ろ |
| 砦 | 砦 | 2 | 左右と後方 |
| 弓 | 弓 | 2 | 飛び駒（障害物を越える） |
| 砲 | 砲 | 1 | 3マス直進 |
| 筒 | 筒 | 1 | 前方2マス |
| 謀 | 謀 | 1 | 敵駒にツケて寝返らせる |

### 特徴的なルール

#### ツケ（スタック）
駒を重ねて配置できます。
- ルールレベルに応じて最大2〜3段まで
- 高い位置の駒が支配権を持つ
- 段数に応じて移動距離が延長される（+1/段）

#### 高さ優位
- 高い段の駒は、低い段の駒から攻撃を受けない
- 同じ高さ以下の駒にのみ攻撃可能

#### 新（あらた）
- 手駒から盤上に駒を配置
- 自分の最前線より前には置けない

## スクリーンショット

```
┌─────────────────────────────────┐
│           軍儀                   │
│         G U N G I               │
│                                 │
│     ┌─────────────────┐         │
│     │   2人対戦        │         │
│     └─────────────────┘         │
│     ┌─────────────────┐         │
│     │   CPU対戦        │         │
│     └─────────────────┘         │
│     ┌─────────────────┐         │
│     │   遊び方         │         │
│     └─────────────────┘         │
└─────────────────────────────────┘
```

## インストール

### 必要条件
- Flutter 3.x以上
- Dart 3.x以上

### セットアップ

```bash
# リポジトリをクローン
git clone https://github.com/hirotaka-iwasaki/gungi.git
cd gungi

# 依存関係をインストール
flutter pub get

# Webで実行
flutter run -d chrome

# または Web サーバーとして起動
flutter run -d web-server --web-port=8080
```

### ビルド

```bash
# Web用ビルド
flutter build web

# iOS用ビルド
flutter build ios

# Android用ビルド
flutter build apk
```

## プロジェクト構成

```
lib/
├── main.dart                 # エントリーポイント
├── models/                   # データモデル
│   ├── piece.dart           # 駒クラス
│   ├── board.dart           # 盤面クラス
│   ├── game_state.dart      # ゲーム状態
│   ├── move.dart            # 指し手データ
│   └── position.dart        # 座標クラス
├── logic/                    # ゲームロジック
│   ├── move_validator.dart  # 合法手判定
│   └── piece_movement.dart  # 駒の移動ルール
├── ai/                       # CPU対戦AI
│   ├── ai_player.dart       # AIインターフェース
│   ├── random_ai.dart       # 初級AI（ランダム）
│   ├── minimax_ai.dart      # 中級・上級AI（Minimax）
│   └── evaluation.dart      # 局面評価関数
├── widgets/                  # UIコンポーネント
│   ├── board_widget.dart    # 盤面表示
│   ├── piece_widget.dart    # 駒表示
│   ├── hand_area_widget.dart # 手駒表示
│   ├── stack_viewer.dart    # スタック詳細
│   └── move_history_widget.dart # 棋譜表示
├── screens/                  # 画面
│   ├── title_screen.dart    # タイトル画面
│   └── game_screen.dart     # 対局画面
├── providers/                # 状態管理
│   └── game_provider.dart   # Riverpodプロバイダー
├── theme/                    # テーマ
│   └── app_theme.dart       # 和風デザイン設定
└── utils/
    └── constants.dart        # 定数定義
```

## 技術スタック

- **フレームワーク**: Flutter 3.x
- **言語**: Dart 3.x
- **状態管理**: Riverpod
- **対応プラットフォーム**: Web, iOS, Android

## AI実装

### アルゴリズム
- **初級**: ランダム選択
- **中級・上級**: Minimax法 + Alpha-Beta枝刈り

### 評価関数
8つの戦略的要素を評価：
1. 駒の価値（帥: 10000点、大: 900点など）
2. 位置ボーナス（中央制圧、前線維持）
3. 高さボーナス（スタック優位）
4. 帥の安全性（護衛駒の数）
5. 前線の位置
6. 中央支配
7. 機動力（移動可能な手数）
8. 駒の連携

## テスト

```bash
# 全テスト実行
flutter test

# ゲームロジックテストのみ
flutter test test/game_logic_test.dart
```

### テストカバレッジ
- Position（座標）テスト
- Piece（駒）テスト
- PieceStack（スタック）テスト
- Board（盤面）テスト
- Move（指し手）テスト
- GameState（ゲーム状態）テスト
- MoveValidator（合法手判定）テスト
- 勝敗判定テスト

## 今後の予定

- [ ] オンライン対戦機能
- [ ] 効果音の追加
- [ ] 棋譜のエクスポート/インポート
- [ ] AIのさらなる強化
- [ ] チュートリアルモード

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 謝辞

- 冨樫義博先生 - HUNTER×HUNTERおよび軍儀の創作者
- UMS (Universal Makyo System) - 軍儀ルールの整備

---

**注意**: 本アプリはファンメイドのプロジェクトであり、公式とは一切関係ありません。
